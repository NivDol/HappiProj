---
title: 'Project Proposal: Suicide Risk Among High School Students'
author: "Amal Dagan, Bar Evron, Niv Dolev, Roni London"
output:
  html_document:
    df_print: paged
  pdf_document:
    number_sections: true
    fig_caption: true
    latex_engine: xelatex
---
```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```
```{r libreries}
library(tidyverse)
library(dplyr)
library(stringr)
library(ggplot2)
library(patchwork)
```

# Introduction
Suicide among adolescents is a major public health concern worldwide. While many studies examine mental health factors, less attention has been given to how personal identity and social context influence suicide attempts among high school students.

**Specific Problem to Solve**  
What personal and social factors (such as gender, race, grade level, sexual identity, and sexual contact history) are associated with higher rates of suicide attempts among high school students?

**Importance**  
Identifying high-risk groups can help educators, policymakers, and mental health professionals develop targeted interventions that reduce suicide rates and promote student well-being. This issue has become even more urgent in recent years, as adolescent mental health has deteriorated significantly following the COVID-19 pandemic, with notable increases in suicide ideation and emotional distress.

**Challenges and Novelty**  
Many demographic variables overlap (e.g., sexual identity and sex of sexual contact), and suicide data can be sparse and sensitive. Our analysis goes beyond standard group comparisons by exploring interactions and risk gradients across multiple identity axes.

**Our Approach**  
We will analyze national-level survey data using exploratory data analysis (EDA), regression models, and visualizations. Our models will focus on predicting suicide attempt rates using identity and social context variables. We will also conduct exploratory data analysis and visualizations to uncover
 patterns and relationships between key factors









# Data

reprocessed dataset (details of the preprocessing steps are provided in the appendix) includes approximately **2,623,976 rows** and **32 variables**. These observations were drawn from nationwide adolescent survey responses collected between 2015 and 2017.The data is publicly available from the CDC's Youth Risk Behavior Surveillance System (YRBSS), provided by the Division of Adolescent School Health (DASH).

For the purpose of this project, we focus on the following key variables that capture individual identity and social context:

- **Race** — Categorical: White, Black, Hispanic, Asian, Native American, Multiple race, Pacific Islander.  
- **Grade** — Ordinal: 9th to 12th grade  
- **Sex** — Categorical: Male, Female, Unknown  
- **Sexual Identity** — Categorical: Heterosexual (Straight), Gay/Lesbian, Bisexual, Unsure  
- **Sex of Sexual Contacts** — Categorical: No sexual contact, Both sexes, Opposite sex only, Same sex only  

These variables will serve as the primary predictors in our analysis, allowing us to assess how demographic and identity-related factors are associated with reported suicide attempt rates among high school students.


# Preliminary Results
We began our analysis by computing the average suicide attempt rate for each category within our key demographic variables. The results suggest clear disparities.
```{r loaoding data}
# טען את קובץ הנתונים
data <- read_csv("YRBSS_clean_noNA.csv", show_col_types = FALSE)

# סינון לנתונים הרלוונטיים לשאלת "ניסיון התאבדות"
suicide_data <- data %>%
  filter(str_detect(ShortQuestionText, regex("suicide attempt", ignore_case = TRUE))) %>%
  filter(!is.na(Greater_Risk_Data_Value))

glimpse(suicide_data)

```

```{r plots-and-table, fig.width=18, fig.height=10, echo=FALSE, warning=FALSE, message=FALSE}
# פונקציה משופרת ליצירת גרפים

# יצירת מילון שמות מקוצרים לכל משתנה
short_labels_sexofcontacts <- c(
  "No sexual contact" = "None",
  "Opposite sex only" = "Opposite",
  "Same sex only" = "Same",
  "Both sexes" = "Both"
)

short_labels_identity <- c(
  "Heterosexual (straight)" = "Hetero",
  "Gay or Lesbian" = "Gay/Les",
  "Bisexual" = "Bi",
  "Not sure" = "Unsure"
)

short_labels_sex <- c(
  "Female" = "F",
  "Male" = "M"
)

# אפשר גם ל־Race ו־Grade אם תרצי
short_labels_race <- c(
  "White" = "White",
  "Black or African American" = "Black",
  "Hispanic/Latino" = "Hisp.",
  "Asian" = "Asian",
  "Native Hawaiian or Other Pacific Islander" = "NHPI",
  "American Indian or Alaska Native" = "AIAN",
  "Multiple races" = "Multi"
)

short_labels_grade <- c(
  "9th" = "9",
  "10th" = "10",
  "11th" = "11",
  "12th" = "12"
)

plot_avg_attempts <- function(variable) {
  data_plot <- suicide_data %>%
    filter(!is.na(Greater_Risk_Data_Value), .data[[variable]] != "Total") %>%
    group_by(.data[[variable]]) %>%
    summarise(avg_attempt = mean(Greater_Risk_Data_Value, na.rm = TRUE))
  
  # קיצור שמות לפי המשתנה
  if(variable == "SexOfSexualContacts") {
    data_plot[[variable]] <- recode(data_plot[[variable]], !!!short_labels_sexofcontacts)
  }
  if(variable == "SexualIdentity") {
    data_plot[[variable]] <- recode(data_plot[[variable]], !!!short_labels_identity)
  }
  if(variable == "Sex") {
    data_plot[[variable]] <- recode(data_plot[[variable]], !!!short_labels_sex)
  }
  if(variable == "Race") {
    data_plot[[variable]] <- recode(data_plot[[variable]], !!!short_labels_race)
  }
  if(variable == "Grade") {
    data_plot[[variable]] <- recode(data_plot[[variable]], !!!short_labels_grade)
  }
  
  ggplot(data_plot, aes(x = reorder(.data[[variable]], -avg_attempt), y = avg_attempt, fill = .data[[variable]])) +
    geom_col(width = 0.4) +
    scale_x_discrete(expand = expansion(mult = c(0.15, 0.15))) +
    scale_y_continuous(expand = expansion(mult = c(0.05, 0.1))) +
    labs(title = paste("Suicide Attempt Rate by", variable),
         x = variable, y = "Average %") +
    theme_minimal(base_size = 11) +
    theme(
      axis.text.x = element_text(angle = 60, hjust = 1, size = 14),
      panel.border = element_rect(color = "black", fill = NA, size = 0.4),
      plot.margin = margin(10, 10, 20, 10),
      legend.position = "none"
    )
}

plot_avg_attempts_sex <- function(variable) {
  suicide_data %>%
    filter(!is.na(Greater_Risk_Data_Value),
           .data[[variable]] != "Total") %>%
    group_by(.data[[variable]]) %>%
    summarise(avg_attempt = mean(Greater_Risk_Data_Value, na.rm = TRUE)) %>%
    ggplot(aes(x = .data[[variable]], y = avg_attempt, fill = .data[[variable]])) +
    geom_col(width = 0.3) +  # עמודות צרות במיוחד
    scale_x_discrete(expand = expansion(mult = c(0.35, 0.35))) + # ריווח גדול מהקצוות
    scale_y_continuous(expand = expansion(mult = c(0.05, 0.12))) +
    labs(title = "Suicide Attempt Rate by Sex",
         x = "Sex", y = "Average %") +
    theme_minimal(base_size = 11) +
    theme(
      axis.text.x = element_text(angle = 0, hjust = 0.5, size = 14),
      panel.border = element_rect(color = "black", fill = NA, size = 0.5),
      plot.margin = margin(10, 10, 20, 10),
      legend.position = "none"
    )
}
# יצירת 3 הגרפים המובילים
p1 <- plot_avg_attempts("SexualIdentity")
p2 <- plot_avg_attempts("SexOfSexualContacts")
p3 <- plot_avg_attempts_sex("Sex")

# הצגת הגרפים בפריסה נוחה
(p1 | p2 | p3) 


```

```{r}
suicide_data %>%
  filter(!is.na(Greater_Risk_Data_Value)) %>%
  group_by(SexOfSexualContacts) %>%
  summarise(
    N = n(),
    Avg_Attempt_Rate = round(mean(Greater_Risk_Data_Value, na.rm = TRUE), 2)
  ) %>%
  arrange(desc(Avg_Attempt_Rate)) %>%
  knitr::kable(
    caption = "Average Suicide Attempt Rate by Sexual Contact Group",
    col.names = c("Sex of Sexual Contacts", "Number of Students", "Average Attempt Rate (%)")
  )


```
```{r}

suicide_data %>%
  count(Sex)

suicide_data %>%
  count(Race)

suicide_data %>%
  count(SexualIdentity)

suicide_data %>%
  count(Grade)
```

```{r}
summary(suicide_data$Greater_Risk_Data_Value)
mean(suicide_data$Greater_Risk_Data_Value, na.rm = TRUE)
sd(suicide_data$Greater_Risk_Data_Value, na.rm = TRUE)

```

```{r}
library(GGally)
suicide_data %>%
  select(where(is.numeric)) %>%
  GGally::ggpairs()

```

```{r}
summary_df <- suicide_data %>%
  group_by(SexualIdentity, Sex) %>%
  summarise(
    Mean_Attempt = mean(Greater_Risk_Data_Value, na.rm = TRUE),
    N = n(),
    SD = sd(Greater_Risk_Data_Value, na.rm = TRUE),
    SE = SD / sqrt(N),
    CI_low = Mean_Attempt - 1.96 * SE,
    CI_high = Mean_Attempt + 1.96 * SE
  )

ggplot(summary_df, aes(x = SexualIdentity, y = Mean_Attempt, fill = Sex)) +
  geom_col(position = "dodge") +
  geom_errorbar(aes(ymin = CI_low, ymax = CI_high), 
                position = position_dodge(0.9), width = 0.2) +
  labs(title = "Suicide Attempt Rate by Sex and Sexual Identity",
       y = "Average %") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}

# סיכום ממוצע לכל שילוב
heatmap_df <- suicide_data %>%
  group_by(Sex, SexualIdentity, Grade) %>%
  summarise(
    Mean_Attempt = mean(Greater_Risk_Data_Value, na.rm = TRUE),
    N = n()
  ) %>%
  ungroup()

# טבלת חום - facet לפי Sex (מין)
ggplot(heatmap_df, aes(x = Grade, y = SexualIdentity, fill = Mean_Attempt)) +
  geom_tile(color = "white") +
  geom_text(aes(label = sprintf("%.1f", Mean_Attempt)), size = 3) +  # מציגים את הערך הממוצע
  facet_wrap(~Sex) +
  scale_fill_gradient(low = "white", high = "red", name = "Average %") +
  labs(title = "Suicide Attempt Rate by Sex, Sexual Identity, and Grade",
       y = "Sexual Identity", x = "Grade") +
  theme_minimal(base_size = 12) +
  theme(axis.text.x = element_text(angle = 0, hjust = 0.5))
```
```{r}
colnames(suicide_data)
```

```{r}


# המרת משתנים לקטגוריים
suicide_data$Sex <- as.factor(suicide_data$Sex)
suicide_data$Grade <- as.factor(suicide_data$Grade)
suicide_data$SexualIdentity <- as.factor(suicide_data$SexualIdentity)
suicide_data$Race <- as.factor(suicide_data$Race)
suicide_data$SexOfSexualContacts <- as.factor(suicide_data$SexOfSexualContacts)

model_data <- na.omit(suicide_data[, c(
  "Greater_Risk_Data_Value",
   "Grade", "SexualIdentity", "Race"
)])

rf_model <- randomForest(
  Greater_Risk_Data_Value ~  Grade + SexualIdentity + Race ,
  data = model_data
)

# יצירת explainer ל-DALEX
explainer_rf <- explain(
  model = rf_model,
  data = model_data[, c( "Grade", "SexualIdentity", "Race")],
  y = model_data$Greater_Risk_Data_Value,
  label = "Random Forest"
)

# חישוב ערכי SHAP לכל הדאטה
shap_values <- predict_parts(
  explainer_rf,
  new_observation = model_data[, c( "Grade", "SexualIdentity", "Race")],
  type = "shap"
)

# גרף SHAP summary
plot(shap_values)
```


```{r}

# ניבוי על הדאטה
model_data$pred <- predict(rf_model, newdata = model_data)

# חישוב R-squared
rss <- sum((model_data$Greater_Risk_Data_Value - model_data$pred)^2)
tss <- sum((model_data$Greater_Risk_Data_Value - mean(model_data$Greater_Risk_Data_Value))^2)
r_squared <- 1 - rss/tss

# חישוב MSE, RMSE, MAE
mse <- mean((model_data$Greater_Risk_Data_Value - model_data$pred)^2)
rmse <- sqrt(mse)
mae <- mean(abs(model_data$Greater_Risk_Data_Value - model_data$pred))

cat("R-squared:", r_squared, "\n")
cat("MSE:", mse, "\n")
cat("RMSE:", rmse, "\n")
cat("MAE:", mae, "\n")
```




```{r}
plot(model_data$Greater_Risk_Data_Value, model_data$pred,
     xlab = "True Value", ylab = "Predicted Value", main = "True vs Predicted")
abline(0, 1, col="red")

```


In order to present our findings clearly and concisely, we chose to focus on three identity-related variables that showed the greatest disparity in suicide attempt rates: Sexual Identity, Sex of Sexual Contacts, and Sex. These dimensions not only exhibit strong variation but are also central to our research question regarding how personal and social identity contribute to suicide risk in adolescents.

These initial visualizations provide strong evidence that suicide attempt rates vary substantially across identity-related factors, including gender, sexual identity, race, grade, and sexual contact history.

By visualizing average attempt rates per group, we identified clear disparities and high-risk categories (e.g., gay or lesbian, 10th–11th graders, students with both-sex sexual contact).

Importantly, the clarity and strength of these early insights demonstrate that the research question is measurable and well-grounded in the available data. The variables are clearly defined, well-populated, and statistically analyzable. These findings confirm that the project is **viable and achievable** using standard R-based methods such as exploratory analysis and regression modeling. 

# Work Plan

**Outcome and Predictors**

The outcome variable (`Y`) in our analysis is a **binary indicator** of elevated suicide risk. Specifically, we define a subgroup as "high risk" if its reported suicide attempt rate exceeds the **overall average** across all students in the dataset. This operationalization allows us to model the problem as a **classification task**.

The explanatory variables (`X`) are:
Race,Grade,Sex,Sexual Identity,Sex of Sexual Contacts

These demographic and identity-related variables are hypothesized to be associated with suicide risk and will be used to predict the binary outcome.

**Planned Analysis**

Our analysis will begin with descriptive statistics and exploratory data visualizations to assess the distribution of suicide attempt rates across different subgroups. 

We will then fit a **logistic regression model** and a **decision tree** to estimate the contribution of each predictor to the probability of elevated suicide risk.

To capture potential non-linear patterns and interactions, we may also implement tree-based ensemble methods such as **random forests** and maybe **Shap**, which are useful for ranking variable importance and improving classification performance.

**Feasibility**

Given the size and richness of the dataset, the availability of well-structured categorical variables, and the clarity of the research question, this analysis is feasible to complete. All proposed methods are well-supported by R packages and align with techniques covered in the course.

**Teamwork**

Project responsibilities will be divided among team members as follows:

- Data preparation and cleaning. (Niv)
- Exploratory analysis and visualization. (Bar)
- Model building and evaluation. (Roni)
- Interpretation of results and final reporting. (Amal)

although we would prefer the project to be divided equally amongst all 4 team members, we have an active miluim participant in our team therefore we need to adjust, and divide the work in a fair and just manner. 
All team members will contribute collaboratively to the best of their capabilities to  ensure consistency and insight at each stage of the project.