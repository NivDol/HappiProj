knitr::opts_chunk$set(echo = TRUE)
data <- read_csv("C:/Users/Niv Dolev/Documents/fourth_sem/data analysys/project/happiness_data_clean_2011_2024.csv")
library(tidyverse)
library(dplyr)
library(stringr)
library(ggplot2)
library(patchwork)
data <- read_csv("C:/Users/Niv Dolev/Documents/fourth_sem/data analysys/project/"happiness_data_clean_2011_2024.csv")
library(tidyverse)
library(dplyr)
library(stringr)
library(ggplot2)
library(patchwork)
data <- read_csv("C:/Users/Niv Dolev/Documents/fourth_sem/data analysys/project/happiness_data_clean_2011_2024.csv")
colnames(data)
summary(data)
glimpse(data)
colnames(happiness_data)
# טען את קובץ הנתונים
happiness_data <- read_csv("happiness_data_clean_2011_2024.csv")
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(tidyverse)
library(dplyr)
library(stringr)
library(ggplot2)
library(patchwork)
library(caret)
library(pROC)
library(readxl)  # חבילה לטעינת קבצי אקסל
# טען את קובץ הנתונים
happiness_data <- read_csv("happiness_data_clean_2011_2024.csv")
#glimpse(happiness_data)
#head(happiness_data)
#summary(happiness_data)
happiness_data <- happiness_data %>%
mutate(`Country name` = trimws(`Country name`))
happiness_data <- happiness_data %>%
group_by(`Country name`) %>%
fill(
`Ladder score`, upperwhisker, lowerwhisker,
`Explained by: Log GDP per capita`, `Explained by: Social support`,
`Explained by: Healthy life expectancy`, `Explained by: Freedom to make life choices`,
`Explained by: Generosity`, `Explained by: Perceptions of corruption`,
`Dystopia + residual`,
.direction = "downup"
) %>%
ungroup()
# מחיקה לדוג' של מדינות לא אמיתיות (אם יש)
happiness_data <- happiness_data %>%
filter(!is.na(`Ladder score`)) # או עמודה עיקרית אחרת
#write_csv(happiness_data, "happiness_data_clean_2011_2024.csv")
happiness_data <- happiness_data %>%
group_by(Year) %>%
mutate(Top_20 = Rank <= 20) %>%
ungroup() %>%
rename(Country_name = `Country name`, Ladder_score = `Ladder score`, Log_GDP = `Explained by: Log GDP per capita`, Social_support = `Explained by: Social support`, Life_expectancy = `Explained by: Healthy life expectancy`, Freedom_of_choices = `Explained by: Freedom to make life choices`, Generosity = `Explained by: Generosity`, Dystopia_and_residual = `Dystopia + residual`, Corruption = `Explained by: Perceptions of corruption` )
#colnames(happiness_data)
# סופרים לכל מדינה בכמה שנים הייתה בטופ 20
top_countries_long <- happiness_data %>%
filter(Top_20) %>%
count(Country_name, name = "Years_in_Top_20") %>%
arrange(desc(Years_in_Top_20))
# תצוגה - 25 הראשונות
#print(top_countries_long, n=25)
tpl1 <- top_countries_long %>%
filter(Years_in_Top_20 >= 5) %>% # תבחרי את הסף שמתאים לויזואליות
ggplot(aes(x = reorder(Country_name, Years_in_Top_20), y = Years_in_Top_20)) +
geom_col(fill = "lightgreen") +
coord_flip() +
labs(
title = "Number of Years Each Country was in the Top 20",
x = "Country",
y = "Years in Top 20"
) +
theme_minimal(base_size = 13) +
theme(
plot.title = element_text(size = 16, face = "bold"),
axis.text = element_text(size = 12),
axis.title = element_text(size = 13)
)
plt1 <- ggplot(happiness_data, aes(x = Social_support, y = Ladder_score)) +
geom_point(alpha=0.4) +
geom_smooth(method="lm", se=FALSE, color="blue") +
labs(title="Ladder score vs Social support")
plt <- ggplot(happiness_data, aes(x=Rank)) + geom_histogram(color="darkblue", fill="lightblue", binwidth=3) +
labs(title="Distribution of rankings")+
theme_minimal(base_size = 13) +
theme(
plot.title = element_text(size = 12, face = "bold"),
axis.text = element_text(size = 12),
axis.title = element_text(size = 13)
)
colnames(happiness_data)
colnames(happiness_data)
library(dplyr)
your_data <- your_data %>%
arrange(Country_name, Year) %>%  # Sort by country and year
group_by(Country_name) %>%      # Process each country separately
mutate(Was_in_Top20_Last_Year = lag(Top_20)) %>%  # Get last year's Top_20
ungroup() %>%  # Remove grouping
mutate(Was_in_Top20_Last_Year = case_when(
is.na(Was_in_Top20_Last_Year) ~ 2,         # No previous data
Was_in_Top20_Last_Year == 1 ~ 1,           # Was in top 20
Was_in_Top20_Last_Year == 0 ~ 0            # Was not in top 20
))
colnames(happiness_data)
library(dplyr)
happiness_data <- happiness_data %>%
arrange(Country_name, Year) %>%  # Sort by country and year
group_by(Country_name) %>%      # Process each country separately
mutate(Was_in_Top20_Last_Year = lag(Top_20)) %>%  # Get last year's Top_20
ungroup() %>%  # Remove grouping
mutate(Was_in_Top20_Last_Year = case_when(
is.na(Was_in_Top20_Last_Year) ~ 2,         # No previous data
Was_in_Top20_Last_Year == 1 ~ 1,           # Was in top 20
Was_in_Top20_Last_Year == 0 ~ 0            # Was not in top 20
))
colnames(happiness_data)
library(dplyr)
happiness_data <- happiness_data %>%
arrange(Country_name, Year) %>%  # Sort by country and year
group_by(Country_name) %>%      # Process each country separately
mutate(Was_in_Top20_Last_Year = lag(Top_20)) %>%  # Get last year's Top_20
ungroup() %>%  # Remove grouping
mutate(Was_in_Top20_Last_Year = case_when(
is.na(Was_in_Top20_Last_Year) ~ 2,         # No previous data
Was_in_Top20_Last_Year == 1 ~ 1,           # Was in top 20
Was_in_Top20_Last_Year == 0 ~ 0            # Was not in top 20
))
colnames(happiness_data)
happiness_data <- happiness_data %>%
group_by(Year) %>%
mutate(Top_20 = Rank <= 20) %>%
ungroup() %>%
rename(Country_name = `Country name`, Ladder_score = `Ladder score`, Log_GDP = `Explained by: Log GDP per capita`, Social_support = `Explained by: Social support`, Life_expectancy = `Explained by: Healthy life expectancy`, Freedom_of_choices = `Explained by: Freedom to make life choices`, Generosity = `Explained by: Generosity`, Dystopia_and_residual = `Dystopia + residual`, Corruption = `Explained by: Perceptions of corruption` )
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(tidyverse)
library(dplyr)
library(stringr)
library(ggplot2)
library(patchwork)
library(caret)
library(pROC)
library(readxl)  # חבילה לטעינת קבצי אקסל
# טען את קובץ הנתונים
happiness_data <- read_csv("happiness_data_clean_2011_2024.csv")
#glimpse(happiness_data)
#head(happiness_data)
#summary(happiness_data)
happiness_data <- happiness_data %>%
mutate(`Country name` = trimws(`Country name`))
happiness_data <- happiness_data %>%
group_by(`Country name`) %>%
fill(
`Ladder score`, upperwhisker, lowerwhisker,
`Explained by: Log GDP per capita`, `Explained by: Social support`,
`Explained by: Healthy life expectancy`, `Explained by: Freedom to make life choices`,
`Explained by: Generosity`, `Explained by: Perceptions of corruption`,
`Dystopia + residual`,
.direction = "downup"
) %>%
ungroup()
# מחיקה לדוג' של מדינות לא אמיתיות (אם יש)
happiness_data <- happiness_data %>%
filter(!is.na(`Ladder score`)) # או עמודה עיקרית אחרת
#write_csv(happiness_data, "happiness_data_clean_2011_2024.csv")
happiness_data <- happiness_data %>%
group_by(Year) %>%
mutate(Top_20 = Rank <= 20) %>%
ungroup() %>%
rename(Country_name = `Country name`, Ladder_score = `Ladder score`, Log_GDP = `Explained by: Log GDP per capita`, Social_support = `Explained by: Social support`, Life_expectancy = `Explained by: Healthy life expectancy`, Freedom_of_choices = `Explained by: Freedom to make life choices`, Generosity = `Explained by: Generosity`, Dystopia_and_residual = `Dystopia + residual`, Corruption = `Explained by: Perceptions of corruption` )
happiness_data <- happiness_data %>%
arrange(Country_name, Year) %>%  # Sort by country and year
group_by(Country_name) %>%      # Process each country separately
mutate(Was_in_Top20_Last_Year = lag(Top_20)) %>%  # Get last year's Top_20
ungroup() %>%  # Remove grouping
mutate(Was_in_Top20_Last_Year = case_when(
is.na(Was_in_Top20_Last_Year) ~ 2,         # No previous data
Was_in_Top20_Last_Year == 1 ~ 1,           # Was in top 20
Was_in_Top20_Last_Year == 0 ~ 0            # Was not in top 20
))
#colnames(happiness_data)
# סופרים לכל מדינה בכמה שנים הייתה בטופ 20
top_countries_long <- happiness_data %>%
filter(Top_20) %>%
count(Country_name, name = "Years_in_Top_20") %>%
arrange(desc(Years_in_Top_20))
# תצוגה - 25 הראשונות
#print(top_countries_long, n=25)
tpl1 <- top_countries_long %>%
filter(Years_in_Top_20 >= 5) %>% # תבחרי את הסף שמתאים לויזואליות
ggplot(aes(x = reorder(Country_name, Years_in_Top_20), y = Years_in_Top_20)) +
geom_col(fill = "lightgreen") +
coord_flip() +
labs(
title = "Number of Years Each Country was in the Top 20",
x = "Country",
y = "Years in Top 20"
) +
theme_minimal(base_size = 13) +
theme(
plot.title = element_text(size = 16, face = "bold"),
axis.text = element_text(size = 12),
axis.title = element_text(size = 13)
)
plt1 <- ggplot(happiness_data, aes(x = Social_support, y = Ladder_score)) +
geom_point(alpha=0.4) +
geom_smooth(method="lm", se=FALSE, color="blue") +
labs(title="Ladder score vs Social support")
plt <- ggplot(happiness_data, aes(x=Rank)) + geom_histogram(color="darkblue", fill="lightblue", binwidth=3) +
labs(title="Distribution of rankings")+
theme_minimal(base_size = 13) +
theme(
plot.title = element_text(size = 12, face = "bold"),
axis.text = element_text(size = 12),
axis.title = element_text(size = 13)
)
colnames(happiness_data)
colnames(happiness_data)
set.seed(123)
# Split data
train_data <- subset(happiness_data, Year < 2023)
test_data <- subset(happiness_data, Year >= 2023)
happiness_data <- happiness_data %>%
group_by(Year) %>%
mutate(Top_20 = Rank <= 20) %>%
ungroup() %>%
rename(Country_name = `Country name`, Ladder_score = `Ladder score`, Log_GDP = `Explained by: Log GDP per capita`, Social_support = `Explained by: Social support`, Life_expectancy = `Explained by: Healthy life expectancy`, Freedom_of_choices = `Explained by: Freedom to make life choices`, Generosity = `Explained by: Generosity`, Dystopia_and_residual = `Dystopia + residual`, Corruption = `Explained by: Perceptions of corruption` )
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(tidyverse)
library(dplyr)
library(stringr)
library(ggplot2)
library(patchwork)
library(caret)
library(pROC)
library(readxl)  # חבילה לטעינת קבצי אקסל
# טען את קובץ הנתונים
happiness_data <- read_csv("happiness_data_clean_2011_2024.csv")
#glimpse(happiness_data)
#head(happiness_data)
#summary(happiness_data)
happiness_data <- happiness_data %>%
mutate(`Country name` = trimws(`Country name`))
happiness_data <- happiness_data %>%
group_by(`Country name`) %>%
fill(
`Ladder score`, upperwhisker, lowerwhisker,
`Explained by: Log GDP per capita`, `Explained by: Social support`,
`Explained by: Healthy life expectancy`, `Explained by: Freedom to make life choices`,
`Explained by: Generosity`, `Explained by: Perceptions of corruption`,
`Dystopia + residual`,
.direction = "downup"
) %>%
ungroup()
# מחיקה לדוג' של מדינות לא אמיתיות (אם יש)
happiness_data <- happiness_data %>%
filter(!is.na(`Ladder score`)) # או עמודה עיקרית אחרת
#write_csv(happiness_data, "happiness_data_clean_2011_2024.csv")
colnames(happiness_data)
set.seed(123)
# Split data
train_data <- subset(happiness_data, Year < 2023)
test_data <- subset(happiness_data, Year >= 2023)
colnames(happiness_data)
# טען את קובץ הנתונים
happiness_data <- read_csv("happiness_data_clean_2011_2024.csv")
#glimpse(happiness_data)
#head(happiness_data)
#summary(happiness_data)
happiness_data <- happiness_data %>%
mutate(`Country name` = trimws(`Country name`))
happiness_data <- happiness_data %>%
group_by(`Country name`) %>%
fill(
`Ladder score`, upperwhisker, lowerwhisker,
`Explained by: Log GDP per capita`, `Explained by: Social support`,
`Explained by: Healthy life expectancy`, `Explained by: Freedom to make life choices`,
`Explained by: Generosity`, `Explained by: Perceptions of corruption`,
`Dystopia + residual`,
.direction = "downup"
) %>%
ungroup()
# מחיקה לדוג' של מדינות לא אמיתיות (אם יש)
happiness_data <- happiness_data %>%
filter(!is.na(`Ladder score`)) # או עמודה עיקרית אחרת
#write_csv(happiness_data, "happiness_data_clean_2011_2024.csv")
set.seed(123)
# Split data
train_data <- subset(happiness_data, Year < 2023)
test_data <- subset(happiness_data, Year >= 2023)
colnames(happiness_data)
happiness_data <- happiness_data %>%
group_by(Year) %>%
mutate(Top_20 = Rank <= 20) %>%
ungroup() %>%
rename(Country_name = `Country name`, Ladder_score = `Ladder score`, Log_GDP = `Explained by: Log GDP per capita`, Social_support = `Explained by: Social support`, Life_expectancy = `Explained by: Healthy life expectancy`, Freedom_of_choices = `Explained by: Freedom to make life choices`, Generosity = `Explained by: Generosity`, Dystopia_and_residual = `Dystopia + residual`, Corruption = `Explained by: Perceptions of corruption` )
happiness_data <- happiness_data %>%
arrange(Country_name, Year) %>%  # Sort by country and year
group_by(Country_name) %>%      # Process each country separately
mutate(Top20_Last = lag(Top_20)) %>%  # Get last year's Top_20
ungroup() %>%  # Remove grouping
mutate(Was_in_Top20_Last_Year = case_when(
is.na(Was_in_Top20_Last_Year) ~ 2,         # No previous data
Was_in_Top20_Last_Year == 1 ~ 1,           # Was in top 20
Was_in_Top20_Last_Year == 0 ~ 0            # Was not in top 20
))
happiness_data <- happiness_data %>%
group_by(Year) %>%
mutate(Top_20 = Rank <= 20) %>%
ungroup() %>%
rename(Country_name = `Country name`, Ladder_score = `Ladder score`, Log_GDP = `Explained by: Log GDP per capita`, Social_support = `Explained by: Social support`, Life_expectancy = `Explained by: Healthy life expectancy`, Freedom_of_choices = `Explained by: Freedom to make life choices`, Generosity = `Explained by: Generosity`, Dystopia_and_residual = `Dystopia + residual`, Corruption = `Explained by: Perceptions of corruption` )
